---
Title: Описание настроек внешнего провайдера OAuth
weight: 40
---

:author: likhobory
:email: likhobory@mail.ru

:toc:
:toc-title: Оглавление

:experimental:

:imagesdir: /images/ru/admin/Email/OAuth-Provider

ifdef::env-github[:imagesdir: ./../../../../../master/static/images/ru/admin/Email/OAuth-Provider]

:btn: btn:

ifdef::env-github[:btn:]

//
:sectnums:
:sectnumlevels: 2
//

== Введение

В этом разделе даётся более подробное описание настроек модуля *Внешние провайдеры OAuth*.


== Типы записей

В качестве администраторы системы вам доступно создание двух видов  записей:

 * Персональные провайдеры OAuth
 ** Доступны только создавшим их пользователям
 ** Предназначены для настройки доступа к личным учётным записям у различных провайдеров, без личного домена. Например, для настройки доступа к вашим учетным записям *_@gmail_* или *_@outlook_*. Они могут иметь общие настройки группы, поскольку значения полей *ID клиента*, *Секрет клиента* и других  будут уникальными для каждой учётной записи.
 * Групповые провайдеры OAuth
 ** Могут быть использованы несколькими пользователями
 ** Предназначены для использования всеми пользователями, имеющими учётные записи в одном и том же домене, например -  *_@example-inc.onmicrosoft.com_*. Значения полей *ID клиента*, *Секрет клиента* и других  будут  одинаковыми для всех учётных записей, использующих этот домен.


Более детальная информация об обеих типах записей, а также о вариантах их использования предоставлена в разделе
link:../inboundemail-securitygroups[Настройка групп пользователей для входящих E-mail].


== Библиотека для работы с OAuth2 

SuiteCRM использует https://oauth2-client.thephpleague.com/[OAuth 2.0 Client от PHP League^].
В качестве провайдера используется GenericProvider.


== Основные настройки

Здесь заполняются основные поля, необходимые для работы провайдера OAuth.
Настройки могут варьироваться в зависимости от используемого провайдера, но большинство из этих полей являются общими для большинства провайдеров.

image:image1.png[Основные настройки для работы с OAuth2]

Детальнее эти поля описаны в разделе 
link:../microsoft-oauth-provider-howto#_настройка_провайдера_microsoft_в_suitecrm[Настройка провайдера Microsoft в SuiteCRM].

== Дополнительные настройки

В зависимости от используемого провайдера вам, возможно, потребуются дополнительные настройки. Если они не указаны, то будут использоваться стандартные значения полей, настроенные по умолчанию.

image:image2.png[Дополнительные настройки для работы с OAuth2]

Дополнительные параметры провайдера:: Параметры, которые передаются провайдеру при инициализации. Могут использоваться во всех запросах.
Разрешение при получении токена:: Разрешение, используемое при получении токена.
Параметры запроса  для получения токена:: Дополнительные параметры, которые могут быть отправлены в запросе на получение токена.
Разрешение при обновлении токена:: Разрешение, используемое при обновлении токена.
Параметры запроса  для обновления токена:: Дополнительные параметры, которые могут быть отправлены в запросе на обновление токена.


== Настройки сопоставления

В настройках можно указать, как сопоставлять поля, полученные в токене, с полями, значения которых хранятся в SuiteCRM. Все поля, кроме типа токена, имеют значения по умолчанию.

image:image3.png[Настройки сопоставления]

В этих настройках можно получить значения, вложенные в массив. Для этого следует определить путь к полю, используя имена ключей и используя точку (.) для их объединения. Например, подключение  Microsoft использует следующее сопоставление для получения типа токена: `values.token_type`.


== Подключения

Подключения — это часть кода, отвечающая за управление запросами к провайдеру на аутентификацию.

Подключение *Microsoft* работает так же, как и подключение *Generic*. Разница в том, что в первом случае используются несколько встроенных значений по умолчанию. Это избавляет вас от лишних шагов настройки и упрощает процесс подключения внешнего провайдера OAuth.


== Внутренний формат настроек

Пример кода, показывающий, как используются вышеописанные поля, приведён в 
link:../../../../../admin/administration-panel/emails/oauth-provider-overview#_8_internal_configuration_format[англоязычном разделе этого руководства].